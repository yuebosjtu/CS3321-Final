<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>医疗数据库管理系统</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/auth.css">
</head>
<body>
    <!-- 登录/注册容器 -->
    <div id="auth-container" class="container">
        <div class="auth-form">
            <h1>医疗数据库管理系统</h1>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('login')">登录</button>
                <button class="tab" onclick="switchTab('register')">注册</button>
            </div>
            
            <div id="login-form" class="form-content active">
                <div class="form-group">
                    <label for="login-username">用户名</label>
                    <input type="text" id="login-username" placeholder="请输入用户名">
                </div>
                <div class="form-group">
                    <label for="login-password">密码</label>
                    <input type="password" id="login-password" placeholder="请输入密码">
                </div>
                <div class="form-group">
                    <label for="login-role">角色</label>
                    <select id="login-role">
                        <option value="visitor">游客</option>
                        <option value="admin">管理员</option>
                    </select>
                </div>
                <button class="btn" onclick="login()">登录</button>
            </div>
            
            <div id="register-form" class="form-content">
                <div class="form-group">
                    <label for="register-username">用户名</label>
                    <input type="text" id="register-username" placeholder="请输入用户名">
                </div>
                <div class="form-group">
                    <label for="register-password">密码</label>
                    <input type="password" id="register-password" placeholder="请输入密码">
                </div>
                <div class="form-group">
                    <label for="register-confirm-password">确认密码</label>
                    <input type="password" id="register-confirm-password" placeholder="请再次输入密码">
                </div>
                <div class="form-group">
                    <label for="register-role">角色</label>
                    <select id="register-role">
                        <option value="visitor">游客</option>
                        <option value="admin">管理员 (需要验证码)</option>
                    </select>
                </div>
                <div class="form-group" id="admin-code-group" style="display: none;">
                    <label for="admin-code">管理员验证码</label>
                    <input type="text" id="admin-code" placeholder="请输入管理员验证码">
                </div>
                <button class="btn" onclick="register()">注册</button>
            </div>
        </div>
    </div>

    <!-- 游客主界面 -->
    <div id="visitor-dashboard" class="container" style="display: none;">
        <header>
            <h1>医疗数据库 - 游客视图</h1>
            <button class="btn logout-btn" onclick="logout()">退出登录</button>
        </header>
        
        <div class="search-section">
            <h2>数据查询</h2>
            <div class="search-options">
                <div class="form-group">
                    <label for="search-table">选择数据表</label>
                    <select id="search-table">
                        <option value="Patients">患者</option>
                        <option value="Prescription">处方</option>
                        <option value="Doctors">医生</option>
                        <option value="Appointments">预约</option>
                        <option value="Billing">账单</option>
                        <option value="Pharmacy">药房</option>
                        <option value="Room_Assignments">房间分配</option>
                        <option value="Ambulance">救护车</option>
                        <option value="Ambulance_Log">救护车日志</option>
                        <option value="Staff">员工</option>
                        <option value="Workers">工人</option>
                        <option value="Nurses">护士</option>
                        <option value="Departments">部门</option>
                        <option value="Blood_Bank">血库</option>
                        <option value="Medical_Records">医疗记录</option>
                        <option value="Medicine">药品</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="search-field">查询字段</label>
                    <select id="search-field">
                        <!-- 动态填充 -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="search-value">查询值</label>
                    <input type="text" id="search-value" placeholder="输入查询值">
                </div>
                
                <button class="btn" onclick="performSearch()">查询</button>
            </div>
        </div>
        
        <div class="quick-access">
            <h2>快速访问</h2>
            <div class="quick-links">
                <button class="quick-btn" onclick="showAllPatients()">查看所有患者</button>
                <button class="quick-btn" onclick="showAllDoctors()">查看所有医生</button>
                <button class="quick-btn" onclick="showAvailableRooms()">查看可用房间</button>
                <button class="quick-btn" onclick="showBloodStock()">查看血库库存</button>
            </div>
        </div>
    </div>

    <!-- 管理员主界面 -->
    <div id="admin-dashboard" class="container" style="display: none;">
        <header>
            <h1>医疗数据库 - 管理视图</h1>
            <button class="btn logout-btn" onclick="logout()">退出登录</button>
        </header>
        
        <div class="admin-nav">
            <button class="admin-nav-btn active" onclick="showAdminSection('manage-data')">数据管理</button>
            <button class="admin-nav-btn" onclick="showAdminSection('add-data')">添加数据</button>
            <button class="admin-nav-btn" onclick="showAdminSection('reports')">报表</button>
            <button class="admin-nav-btn" onclick="showAdminSection('user-management')">用户管理</button>
        </div>
        
        <div id="manage-data-section" class="admin-section active">
            <h2>数据管理</h2>
            <div class="form-group">
                <label for="admin-table">选择数据表</label>
                <select id="admin-table" onchange="updateAdminFields()">
                    <option value="Patients">患者</option>
                    <option value="Prescription">处方</option>
                    <option value="Doctors">医生</option>
                    <option value="Appointments">预约</option>
                    <option value="Billing">账单</option>
                    <option value="Pharmacy">药房</option>
                    <option value="Room_Assignments">房间分配</option>
                    <option value="Ambulance">救护车</option>
                    <option value="Ambulance_Log">救护车日志</option>
                    <option value="Staff">员工</option>
                    <option value="Workers">工人</option>
                    <option value="Nurses">护士</option>
                    <option value="Departments">部门</option>
                    <option value="Blood_Bank">血库</option>
                    <option value="Medical_Records">医疗记录</option>
                    <option value="Medicine">药品</option>
                </select>
            </div>
            
            <div class="admin-actions">
                <button class="btn" onclick="adminViewAll()">查看全部</button>
                <button class="btn" onclick="adminEditSelected()">编辑选中</button>
                <button class="btn btn-danger" onclick="adminDeleteSelected()">删除选中</button>
            </div>
            
            <div class="admin-data-table">
                <table id="admin-data-display">
                    <thead>
                        <tr>
                            <!-- 动态填充 -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 动态填充 -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="add-data-section" class="admin-section">
            <h2>添加数据</h2>
            <div class="form-group">
                <label for="add-table">选择数据表</label>
                <select id="add-table" onchange="showAddForm()">
                    <option value="">-- 选择表 --</option>
                    <option value="Patients">患者</option>
                    <option value="Prescription">处方</option>
                    <option value="Doctors">医生</option>
                    <option value="Appointments">预约</option>
                    <option value="Billing">账单</option>
                    <option value="Pharmacy">药房</option>
                    <option value="Room_Assignments">房间分配</option>
                    <option value="Ambulance">救护车</option>
                    <option value="Ambulance_Log">救护车日志</option>
                    <option value="Staff">员工</option>
                    <option value="Workers">工人</option>
                    <option value="Nurses">护士</option>
                    <option value="Departments">部门</option>
                    <option value="Blood_Bank">血库</option>
                    <option value="Medical_Records">医疗记录</option>
                    <option value="Medicine">药品</option>
                </select>
            </div>
            
            <div id="add-data-form">
                <!-- 动态填充 -->
            </div>
        </div>
        
        <div id="reports-section" class="admin-section">
            <h2>报表</h2>
            <div class="report-options">
                <div class="form-group">
                    <label for="report-type">报表类型</label>
                    <select id="report-type">
                        <option value="patient-stats">患者统计</option>
                        <option value="doctor-appointments">医生预约</option>
                        <option value="billing-summary">账单汇总</option>
                        <option value="medicine-inventory">药品库存</option>
                        <option value="room-utilization">房间使用率</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="report-period">时间范围</label>
                    <select id="report-period">
                        <option value="today">今日</option>
                        <option value="week">本周</option>
                        <option value="month">本月</option>
                        <option value="quarter">本季度</option>
                        <option value="year">本年</option>
                        <option value="custom">自定义</option>
                    </select>
                </div>
                
                <div id="custom-date-range" style="display: none;">
                    <div class="form-group">
                        <label for="start-date">开始日期</label>
                        <input type="date" id="start-date">
                    </div>
                    <div class="form-group">
                        <label for="end-date">结束日期</label>
                        <input type="date" id="end-date">
                    </div>
                </div>
                
                <button class="btn" onclick="generateReport()">生成报表</button>
            </div>
            
            <div id="report-results">
                <!-- 动态填充 -->
            </div>
        </div>
        
        <div id="user-management-section" class="admin-section">
            <h2>用户管理</h2>
            <div class="user-actions">
                <button class="btn" onclick="showAllUsers()">查看所有用户</button>
                <button class="btn" onclick="showAddUserForm()">添加新用户</button>
                <button class="btn btn-danger" onclick="deleteSelectedUsers()">删除选中用户</button>
            </div>
            
            <div id="user-list">
                <table>
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="select-all-users"></th>
                            <th>用户名</th>
                            <th>角色</th>
                            <th>注册日期</th>
                            <th>最后登录</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 动态填充 -->
                    </tbody>
                </table>
            </div>
            
            <div id="add-user-form" style="display: none;">
                <div class="form-group">
                    <label for="new-username">用户名</label>
                    <input type="text" id="new-username">
                </div>
                <div class="form-group">
                    <label for="new-password">密码</label>
                    <input type="password" id="new-password">
                </div>
                <div class="form-group">
                    <label for="new-role">角色</label>
                    <select id="new-role">
                        <option value="visitor">游客</option>
                        <option value="admin">管理员</option>
                    </select>
                </div>
                <button class="btn" onclick="addNewUser()">添加用户</button>
            </div>
        </div>
    </div>

    <!-- 查询结果页面 -->
    <div id="results-container" class="container" style="display: none;">
        <header>
            <h1>查询结果</h1>
            <button class="btn back-btn" onclick="goBack()">返回</button>
        </header>
        
        <div class="results-info">
            <h2 id="results-title"></h2>
            <p id="results-query"></p>
        </div>
        
        <div class="results-table">
            <table id="results-data">
                <thead>
                    <tr>
                        <!-- 动态填充 -->
                    </tr>
                </thead>
                <tbody>
                    <!-- 动态填充 -->
                </tbody>
            </table>
        </div>
        
        <div class="results-actions">
            <button class="btn" onclick="exportToCSV()">导出为CSV</button>
            <button class="btn" onclick="printResults()">打印结果</button>
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/visitor.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/results.js"></script>
</body>
</html>